<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Gerador de Pix Est치tico V치lido</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    label { display: block; margin-top: 10px; }
    input, select, textarea { width: 100%; padding: 8px; margin-top: 4px; }
    button { margin-top: 20px; padding: 10px 20px; }
    #qrcode { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Gerador de QR Code Pix Est치tico</h1>

  <label>Tipo da Chave:</label>
  <select id="tipo">
    <option value="email">E-mail</option>
    <option value="telefone">Telefone</option>
    <option value="cpf">CPF</option>
    <option value="cnpj">CNPJ</option>
    <option value="aleatoria">Aleat칩ria</option>
  </select>

  <label>Chave Pix:</label>
  <input type="text" id="chave" />

  <label>Identificador (opcional):</label>
  <input type="text" id="identificador" />

  <label>Valor (opcional):</label>
  <input type="text" id="valor" placeholder="Ex: 25.50" />

  <button onclick="gerarPix()">Gerar QR Code</button>

  <div id="resultado">
    <label>Pix Copia e Cola:</label>
    <textarea id="pixCode" readonly></textarea>
    <div id="qrcode"></div>
  </div>

  <script>
    function crc16(str) {
      let crc = 0xFFFF;
      for (let i = 0; i < str.length; i++) {
        crc ^= str.charCodeAt(i) << 8;
        for (let j = 0; j < 8; j++) {
          if ((crc & 0x8000) !== 0) {
            crc = (crc << 1) ^ 0x1021;
          } else {
            crc <<= 1;
          }
          crc &= 0xFFFF;
        }
      }
      return crc.toString(16).toUpperCase().padStart(4, '0');
    }

    function formatTLV(id, value) {
      const length = value.length.toString().padStart(2, '0');
      return id + length + value;
    }

    function gerarPix() {
      const chave = document.getElementById('chave').value.trim();
      const identificador = document.getElementById('identificador').value.trim();
      const valor = document.getElementById('valor').value.trim();

      if (!chave) {
        alert('Informe a chave Pix.');
        return;
      }

      const gui = formatTLV("00", "BR.GOV.BCB.PIX");
      const chavePix = formatTLV("01", chave);
      const merchantAccountInfo = formatTLV("26", gui + chavePix);
      const txid = identificador ? formatTLV("05", identificador) : formatTLV("05", "***");
      const additionalDataField = formatTLV("62", txid);
      const valorFormatado = valor ? formatTLV("54", valor) : "";
      const payloadSemCRC = 
        formatTLV("00", "01") +
        formatTLV("01", "12") +
        merchantAccountInfo +
        valorFormatado +
        formatTLV("58", "BR") +
        additionalDataField +
        "6304";

      const crc = crc16(payloadSemCRC);
      const payloadFinal = payloadSemCRC + crc;

      document.getElementById('pixCode').value = payloadFinal;

      const qrArea = document.getElementById('qrcode');
      qrArea.innerHTML = '';
      new QRCode(qrArea, {
        text: payloadFinal,
        width: 256,
        height: 256
      });
    }
  </script>
</body>
</html>
