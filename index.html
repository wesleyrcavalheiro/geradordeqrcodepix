<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Gerador de Pix Estático</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    label { display: block; margin-top: 10px; }
    input, select, textarea { width: 100%; padding: 8px; margin-top: 4px; }
    button { margin-top: 15px; padding: 10px 20px; cursor: pointer; }
    .button-group button { margin-right: 10px; }
    #qrcode { margin-top: 20px; }
    #pixCodeGroup { display: flex; align-items: center; gap: 10px; margin-top: 10px; }
    #pixCode { flex: 1; height: 80px; }
  </style>
</head>
<body>
  <h1>Gerador de QR Code Pix Estático</h1>

  <label>Tipo da Chave:</label>
  <select id="tipo">
    <option value="email">E-mail</option>
    <option value="telefone">Telefone</option>
    <option value="cpf">CPF</option>
    <option value="cnpj">CNPJ</option>
    <option value="aleatoria">Aleatória</option>
  </select>

  <label>Chave Pix:</label>
  <input type="text" id="chave" />

  <label>Identificador (opcional):</label>
  <input type="text" id="identificador" />

  <label>Valor (opcional):</label>
  <input type="text" id="valor" placeholder="Ex: 25.50" />

  <button onclick="gerarPix()">Gerar QR Code</button>

  <div id="resultado" style="display: none;">
    <label>Pix Copia e Cola:</label>
    <div id="pixCodeGroup">
      <textarea id="pixCode" readonly></textarea>
      <button onclick="copiarPix()">Copiar</button>
    </div>

    <div id="qrcode"></div>

    <div class="button-group">
      <button onclick="window.open('placa.html', '_blank')">Criar Placa Pix gratuita</button>
      <button onclick="baixarQR()">Baixar QR Code Pix</button>
      <button onclick="window.location.reload()">Criar Novo QR Code Pix</button>
    </div>
  </div>

  <script>
    function crc16(str) {
      let crc = 0xFFFF;
      for (let i = 0; i < str.length; i++) {
        crc ^= str.charCodeAt(i) << 8;
        for (let j = 0; j < 8; j++) {
          crc = (crc & 0x8000) ? (crc << 1) ^ 0x1021 : (crc << 1);
          crc &= 0xFFFF;
        }
      }
      return crc.toString(16).toUpperCase().padStart(4, '0');
    }

    function formatTLV(id, value) {
      return id + value.length.toString().padStart(2, '0') + value;
    }

    function gerarPix() {
      const chave = document.getElementById('chave').value.trim();
      const identificador = document.getElementById('identificador').value.trim();
      const valor = document.getElementById('valor').value.trim();

      if (!chave) {
        alert('Informe a chave Pix.');
        return;
      }

      const nome = "RAISSA MATIOLI";
      const cidade = "SAO PAULO";

      const gui = formatTLV("00", "BR.GOV.BCB.PIX");
      const chavePix = formatTLV("01", chave);
      const merchantAccountInfo = formatTLV("26", gui + chavePix);
      const txid = identificador ? formatTLV("05", identificador) : formatTLV("05", "***");
      const additionalDataField = formatTLV("62", txid);
      const valorFormatado = valor ? formatTLV("54", valor) : "";
      const payloadSemCRC =
        formatTLV("00", "01") +
        formatTLV("01", "12") +
        merchantAccountInfo +
        formatTLV("52", "0000") +
        formatTLV("53", "986") +
        valorFormatado +
        formatTLV("58", "BR") +
        formatTLV("59", nome.slice(0, 25)) +
        formatTLV("60", cidade.slice(0, 15)) +
        additionalDataField +
        "6304";

      const crc = crc16(payloadSemCRC);
      const payloadFinal = payloadSemCRC + crc;

      document.getElementById('pixCode').value = payloadFinal;
      document.getElementById('resultado').style.display = 'block';

      const qrArea = document.getElementById('qrcode');
      qrArea.innerHTML = '';
      const qr = new QRCode(qrArea, {
        text: payloadFinal,
        width: 256,
        height: 256
      });

      setTimeout(() => {
        const img = qrArea.querySelector("img");
        if (img) img.id = "qrimage";
      }, 500);
    }

    function copiarPix() {
      const texto = document.getElementById('pixCode');
      texto.select();
      document.execCommand('copy');
      alert('Código Pix copiado!');
    }

    function baixarQR() {
      const img = document.getElementById('qrimage');
      if (img) {
        const link = document.createElement('a');
        link.href = img.src;
        link.download = 'qrcode_pix.png';
        link.click();
      } else {
        alert('QR Code ainda não gerado.');
      }
    }
  </script>
</body>
</html>
